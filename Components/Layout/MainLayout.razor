@inherits LayoutComponentBase
@using BlazorBlog.Components.Shared
@inject AuthenticationStateProvider AuthStateProvider

<div class="page">
    <header class="site-header">
        <div class="container d-flex align-items-center justify-content-between">
            <div class="d-flex align-items-center gap-4">
                <a href="/" class="brand-logo">
                    <i class="bi bi-send-fill me-2"></i>
                    IT技术社区
                    <span class="brand-subtitle">TECH COMMUNITY</span>
                </a>
                <nav class="site-nav d-none d-md-flex">
                    <a href="/" class="nav-link active"><i class="bi bi-house-door me-1"></i> 首页</a>
                    <a href="#" class="nav-link"><i class="bi bi-compass me-1"></i> 探索</a>
                    <a href="#" class="nav-link"><i class="bi bi-bookmark me-1"></i> 话题</a>
                    <a href="#" class="nav-link"><i class="bi bi-tools me-1"></i> 工具</a>
                    <a href="#" class="nav-link"><i class="bi bi-journal-text me-1"></i> 专栏</a>
                    <a href="#" class="nav-link"><i class="bi bi-trophy me-1"></i> 活动</a>
                </nav>
            </div>
            
            <div class="d-flex align-items-center gap-3">
                <div class="search-box d-none d-lg-flex">
                    <i class="bi bi-search"></i>
                    <input type="text" placeholder="搜索文章、标签" />
                    <span class="search-shortcut">⌘ K</span>
                </div>
                <button class="btn btn-icon"><i class="bi bi-sun"></i></button>
                <AuthorizeView>
                    <Authorized>
                        <div class="dropdown">
                            <button class="btn btn-icon dropdown-toggle" type="button" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="bi bi-person-circle" style="font-size: 1.5rem;"></i>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                                <li class="dropdown-header">
                                    <div class="d-flex align-items-center">
                                        <i class="bi bi-person-circle me-2" style="font-size: 2rem;"></i>
                                        <div>
                                            <div class="fw-bold">@context.User.Identity?.Name</div>
                                            <small class="text-muted">@(context.User.IsInRole("admin") ? "管理员" : "普通用户")</small>
                                        </div>
                                    </div>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#"><i class="bi bi-journal-text me-2"></i>我的博客</a></li>
                                <li><a class="dropdown-item" href="#"><i class="bi bi-people me-2"></i>我的圈子</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#"><i class="bi bi-gear me-2"></i>账号设置</a></li>
                                <li><a class="dropdown-item" href="#"><i class="bi bi-star me-2"></i>会员中心</a></li>
                                @if (context.User.IsInRole("admin"))
                                {
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item" href="/admin"><i class="bi bi-shield-lock me-2"></i>后台管理</a></li>
                                }
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#"><i class="bi bi-moon me-2"></i>简洁模式</a></li>
                                <li><a class="dropdown-item text-danger" @onclick="Logout"><i class="bi bi-box-arrow-right me-2"></i>退出登录</a></li>
                            </ul>
                        </div>
                    </Authorized>
                    <NotAuthorized>
                        <LoginControl />
                        <RegisterControl />
                    </NotAuthorized>
                </AuthorizeView>
            </div>
        </div>
    </header>

    <main class="main-content">
        @Body
    </main>
    
    <GlobalOverlay />
</div>

<div id="blazor-error-ui" data-nosnippet>
    An unhandled error has occurred.
    <a href="." class="reload">Reload</a>
    <span class="dismiss">🗙</span>
</div>

@code {
    [Inject] private NavigationManager Navigation { get; set; } = default!;

    private async Task Logout()
    {
        var authProvider = (CustomAuthenticationStateProvider)AuthStateProvider;
        await authProvider.UpdateAuthenticationState(null);
        Navigation.NavigateTo("/", forceLoad: true);
    }
}