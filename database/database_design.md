# åšå®¢æ•°æ®åº“è®¾è®¡æ–‡æ¡£

## ğŸ“Š æ•°æ®åº“æ¦‚è§ˆ

æœ¬è®¾è®¡åŸºäº PostgreSQLï¼Œä¸º IT æŠ€æœ¯ç¤¾åŒºåšå®¢ç³»ç»Ÿæä¾›å®Œæ•´çš„æ•°æ®æ”¯æŒã€‚

### æ ¸å¿ƒç‰¹æ€§
- âœ… ä½¿ç”¨ UUID ä½œä¸ºä¸»é”®ï¼Œé¿å… ID å†²çª
- âœ… å®Œæ•´çš„ç´¢å¼•ä¼˜åŒ–ï¼Œæå‡æŸ¥è¯¢æ€§èƒ½
- âœ… è½¯åˆ é™¤æ”¯æŒï¼Œæ•°æ®å¯æ¢å¤
- âœ… å®¡è®¡å­—æ®µï¼ˆcreated_at, updated_atï¼‰
- âœ… è‡ªåŠ¨æ›´æ–°æ—¶é—´æˆ³è§¦å‘å™¨
- âœ… å¤–é”®çº¦æŸä¿è¯æ•°æ®å®Œæ•´æ€§

---

## ğŸ—‚ï¸ æ•°æ®åº“è¡¨ç»“æ„

### 1. ç”¨æˆ·ç®¡ç†

#### usersï¼ˆç”¨æˆ·è¡¨ï¼‰
å­˜å‚¨ç”¨æˆ·åŸºæœ¬ä¿¡æ¯å’Œè®¤è¯æ•°æ®

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | UUID | ä¸»é”® |
| username | VARCHAR(50) | ç”¨æˆ·åï¼ˆå”¯ä¸€ï¼‰ |
| email | VARCHAR(255) | é‚®ç®±ï¼ˆå”¯ä¸€ï¼‰ |
| phone | VARCHAR(20) | æ‰‹æœºå·ï¼ˆå”¯ä¸€ï¼‰ |
| password_hash | VARCHAR(255) | å¯†ç å“ˆå¸Œ |
| avatar_url | VARCHAR(500) | å¤´åƒ URL |
| nickname | VARCHAR(100) | æ˜µç§° |
| bio | TEXT | ä¸ªäººç®€ä»‹ |
| role | VARCHAR(20) | è§’è‰²ï¼šuser, admin, moderator |
| followers_count | INTEGER | ç²‰ä¸æ•° |
| following_count | INTEGER | å…³æ³¨æ•° |
| posts_count | INTEGER | æ–‡ç« æ•° |

#### user_sessionsï¼ˆç”¨æˆ·ä¼šè¯è¡¨ï¼‰
ç®¡ç†ç”¨æˆ·ç™»å½•ä¼šè¯å’Œ Token

---

### 2. å†…å®¹ç®¡ç†

#### postsï¼ˆæ–‡ç« è¡¨ï¼‰
å­˜å‚¨åšå®¢æ–‡ç« å†…å®¹å’Œå…ƒæ•°æ®

| å…³é”®å­—æ®µ | è¯´æ˜ |
|---------|------|
| title | æ–‡ç« æ ‡é¢˜ |
| slug | URL å‹å¥½çš„æ ‡è¯†ç¬¦ï¼ˆå¦‚ï¼š`how-to-use-blazor`ï¼‰ |
| content | æ–‡ç« æ­£æ–‡ï¼ˆæ”¯æŒ Markdownï¼‰ |
| summary | æ–‡ç« æ‘˜è¦ |
| status | çŠ¶æ€ï¼šdraftï¼ˆè‰ç¨¿ï¼‰ã€publishedï¼ˆå·²å‘å¸ƒï¼‰ã€archivedï¼ˆå½’æ¡£ï¼‰ |
| visibility | å¯è§æ€§ï¼špublicã€privateã€unlisted |
| is_featured | æ˜¯å¦ä¸ºç²¾é€‰æ–‡ç«  |
| views_count | æµè§ˆé‡ |
| likes_count | ç‚¹èµæ•° |
| comments_count | è¯„è®ºæ•° |

#### categoriesï¼ˆåˆ†ç±»è¡¨ï¼‰
æ”¯æŒå±‚çº§åˆ†ç±»ï¼ˆparent_id å®ç°çˆ¶å­å…³ç³»ï¼‰

#### tagsï¼ˆæ ‡ç­¾è¡¨ï¼‰
æ ‡ç­¾ç³»ç»Ÿï¼Œæ”¯æŒå¤šæ ‡ç­¾

#### post_categoriesï¼ˆæ–‡ç« åˆ†ç±»å…³è”è¡¨ï¼‰
å¤šå¯¹å¤šå…³ç³»ï¼šä¸€ç¯‡æ–‡ç« å¯å±äºå¤šä¸ªåˆ†ç±»

#### post_tagsï¼ˆæ–‡ç« æ ‡ç­¾å…³è”è¡¨ï¼‰
å¤šå¯¹å¤šå…³ç³»ï¼šä¸€ç¯‡æ–‡ç« å¯æœ‰å¤šä¸ªæ ‡ç­¾

---

### 3. äº’åŠ¨åŠŸèƒ½

#### commentsï¼ˆè¯„è®ºè¡¨ï¼‰
æ”¯æŒå¤šçº§è¯„è®ºå›å¤ï¼ˆparent_id å®ç°è¯„è®ºæ ‘ï¼‰

| åŠŸèƒ½ | å®ç° |
|------|------|
| è¯„è®ºå›å¤ | parent_id å¤–é”®å¼•ç”¨è‡ªèº« |
| ç½®é¡¶è¯„è®º | is_pinned å­—æ®µ |
| è¯„è®ºå®¡æ ¸ | status å­—æ®µï¼ˆpublished/pending/rejectedï¼‰ |

#### likesï¼ˆç‚¹èµè¡¨ï¼‰
é€šç”¨ç‚¹èµç³»ç»Ÿï¼Œæ”¯æŒæ–‡ç« å’Œè¯„è®ºç‚¹èµ

```sql
target_type: 'post' æˆ– 'comment'
target_id: å¯¹åº”çš„ post_id æˆ– comment_id
```

#### favoritesï¼ˆæ”¶è—è¡¨ï¼‰
ç”¨æˆ·æ”¶è—æ–‡ç« åŠŸèƒ½

#### followsï¼ˆå…³æ³¨è¡¨ï¼‰
ç”¨æˆ·ä¹‹é—´çš„å…³æ³¨å…³ç³»

```sql
follower_id: å…³æ³¨è€…
following_id: è¢«å…³æ³¨è€…
```

---

### 4. ç»Ÿè®¡åˆ†æ

#### post_viewsï¼ˆæ–‡ç« æµè§ˆå†å²ï¼‰
è®°å½•æ¯æ¬¡æ–‡ç« æµè§ˆï¼Œæ”¯æŒï¼š
- ç”¨æˆ·æµè§ˆå†å²ï¼ˆå·²ç™»å½•ç”¨æˆ·ï¼‰
- IP ç»Ÿè®¡ï¼ˆæœªç™»å½•ç”¨æˆ·ï¼‰
- User-Agent åˆ†æ

#### notificationsï¼ˆé€šçŸ¥è¡¨ï¼‰
ç³»ç»Ÿé€šçŸ¥åŠŸèƒ½

| é€šçŸ¥ç±»å‹ | è¯´æ˜ |
|---------|------|
| comment | æ–°è¯„è®ºé€šçŸ¥ |
| like | ç‚¹èµé€šçŸ¥ |
| follow | å…³æ³¨é€šçŸ¥ |
| mention | @æåŠé€šçŸ¥ |
| system | ç³»ç»Ÿé€šçŸ¥ |

---

## ğŸ”— è¡¨å…³ç³»å›¾

```mermaid
erDiagram
    users ||--o{ posts : "å‘å¸ƒ"
    users ||--o{ comments : "è¯„è®º"
    users ||--o{ likes : "ç‚¹èµ"
    users ||--o{ favorites : "æ”¶è—"
    users ||--o{ follows : "å…³æ³¨/è¢«å…³æ³¨"
    users ||--o{ notifications : "æ¥æ”¶"
    
    posts ||--o{ comments : "åŒ…å«"
    posts ||--o{ post_tags : "æ ‡è®°"
    posts ||--o{ post_categories : "åˆ†ç±»"
    posts ||--o{ post_views : "æµè§ˆè®°å½•"
    posts ||--o{ likes : "è¢«ç‚¹èµ"
    posts ||--o{ favorites : "è¢«æ”¶è—"
    
    tags ||--o{ post_tags : "æ ‡è®°æ–‡ç« "
    categories ||--o{ post_categories : "åˆ†ç±»æ–‡ç« "
    categories ||--o{ categories : "çˆ¶å­åˆ†ç±»"
    
    comments ||--o{ comments : "è¯„è®ºå›å¤"
    comments ||--o{ likes : "è¢«ç‚¹èµ"
```

---

## ğŸ“ˆ æ ¸å¿ƒåŠŸèƒ½æ”¯æŒ

### âœ… ç”¨æˆ·ç³»ç»Ÿ
- [x] ç”¨æˆ·æ³¨å†Œ/ç™»å½•
- [x] æ‰‹æœºå·/é‚®ç®±éªŒè¯
- [x] è§’è‰²æƒé™ç®¡ç†
- [x] ç”¨æˆ·å…³æ³¨ç³»ç»Ÿ
- [x] ç”¨æˆ·ç»Ÿè®¡æ•°æ®

### âœ… æ–‡ç« ç³»ç»Ÿ
- [x] æ–‡ç« å‘å¸ƒ/ç¼–è¾‘/åˆ é™¤
- [x] è‰ç¨¿åŠŸèƒ½
- [x] åˆ†ç±»å’Œæ ‡ç­¾
- [x] SEO ä¼˜åŒ–å­—æ®µ
- [x] ç²¾é€‰æ–‡ç« 
- [x] è½¬è½½æ ‡è®°

### âœ… äº’åŠ¨ç³»ç»Ÿ
- [x] è¯„è®ºå’Œå›å¤
- [x] ç‚¹èµåŠŸèƒ½
- [x] æ”¶è—åŠŸèƒ½
- [x] æµè§ˆç»Ÿè®¡
- [x] æ¶ˆæ¯é€šçŸ¥

### âœ… æ•°æ®åˆ†æ
- [x] æ–‡ç« æµè§ˆåˆ†æ
- [x] ç”¨æˆ·è¡Œä¸ºè·Ÿè¸ª
- [x] ç»Ÿè®¡æ•°æ®ç¼“å­˜

---

## ğŸš€ ä½¿ç”¨æŒ‡å—

### 1. åˆ›å»ºæ•°æ®åº“

```bash
# åˆ›å»ºæ•°æ®åº“
createdb blazor_blog

# è¿æ¥æ•°æ®åº“
psql -d blazor_blog

# æ‰§è¡Œ schema
\i database_schema.sql
```

### 2. é…ç½®è¿æ¥å­—ç¬¦ä¸²ï¼ˆ.NETï¼‰

```json
{
  "ConnectionStrings": {
    "DefaultConnection": "Host=localhost;Database=blazor_blog;Username=your_user;Password=your_password"
  }
}
```

### 3. å®‰è£… Npgsqlï¼ˆEF Core Providerï¼‰

```bash
dotnet add package Npgsql.EntityFrameworkCore.PostgreSQL
dotnet add package Microsoft.EntityFrameworkCore.Design
```

---

## ğŸ”§ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### ç´¢å¼•ç­–ç•¥
- âœ… å·²ä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µåˆ›å»ºç´¢å¼•
- âœ… å¤–é”®å­—æ®µè‡ªåŠ¨ç´¢å¼•
- âœ… æ’åºå­—æ®µï¼ˆcreated_at DESCï¼‰ç´¢å¼•

### æŸ¥è¯¢ä¼˜åŒ–
```sql
-- ä½¿ç”¨ç´¢å¼•æŸ¥è¯¢æœ€æ–°æ–‡ç« 
SELECT * FROM posts 
WHERE status = 'published' 
ORDER BY published_at DESC 
LIMIT 10;

-- ä½¿ç”¨æ ‡ç­¾æŸ¥è¯¢æ–‡ç« 
SELECT p.* FROM posts p
INNER JOIN post_tags pt ON p.id = pt.post_id
INNER JOIN tags t ON pt.tag_id = t.id
WHERE t.slug = 'blazor';
```

### åˆ†é¡µæŸ¥è¯¢
```sql
-- æ¸¸æ ‡åˆ†é¡µï¼ˆæ¨èï¼‰
SELECT * FROM posts 
WHERE published_at < '2024-01-01' 
ORDER BY published_at DESC 
LIMIT 20;
```

---

## ğŸ›¡ï¸ å®‰å…¨å»ºè®®

1. **å¯†ç å­˜å‚¨**ï¼šä½¿ç”¨ BCrypt æˆ– Argon2 å“ˆå¸Œ
2. **SQL æ³¨å…¥**ï¼šä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
3. **æƒé™æ§åˆ¶**ï¼šæ•°æ®åº“ç”¨æˆ·æœ€å°æƒé™åŸåˆ™
4. **å¤‡ä»½ç­–ç•¥**ï¼šå®šæœŸå¤‡ä»½æ•°æ®åº“
5. **æ•æ„Ÿæ•°æ®**ï¼šå¯¹ password_hashã€token ç­‰å­—æ®µåŠ å¯†å­˜å‚¨

---

## ğŸ“ è¿ç§»å’Œæ¼”è¿›

æœ¬è®¾è®¡æ”¯æŒæ¸è¿›å¼å¼€å‘ï¼š

1. **ç¬¬ä¸€é˜¶æ®µ**ï¼šç”¨æˆ· + æ–‡ç«  + åˆ†ç±»/æ ‡ç­¾
2. **ç¬¬äºŒé˜¶æ®µ**ï¼šè¯„è®º + ç‚¹èµ + æ”¶è—
3. **ç¬¬ä¸‰é˜¶æ®µ**ï¼šå…³æ³¨ + é€šçŸ¥ + ç»Ÿè®¡

å¯æ ¹æ®å®é™…éœ€æ±‚é€æ­¥å®ç°å„ä¸ªåŠŸèƒ½æ¨¡å—ã€‚
